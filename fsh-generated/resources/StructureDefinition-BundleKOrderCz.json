{
  "resourceType": "StructureDefinition",
  "id": "BundleKOrderCz",
  "url": "https://hl7.cz/fhir/korder/StructureDefinition/BundleKOrderCz",
  "name": "BundleKOrderCz",
  "title": "Bundle: Referral Order (CZ)",
  "status": "draft",
  "publisher": "HL7 CZ",
  "description": "Clinical document container for Czech referral/requests (K-order and FT-order).",
  "purpose": "A structured Czech request bundle containing Composition + related resources.",
  "fhirVersion": "4.0.1",
  "kind": "resource",
  "abstract": false,
  "type": "Bundle",
  "baseDefinition": "http://hl7.org/fhir/StructureDefinition/Bundle",
  "derivation": "constraint",
  "differential": {
    "element": [
      {
        "id": "Bundle",
        "path": "Bundle",
        "short": "Referral order document Bundle (CZ)",
        "definition": "The document Bundle for CZ requests. It SHALL contain exactly one Composition and all referenced resources.",
        "constraint": [
          {
            "key": "one-comp",
            "severity": "error",
            "human": "The document Bundle SHALL include one and only one Composition.",
            "expression": "entry.resource.ofType(Composition).count() = 1",
            "source": "https://hl7.cz/fhir/korder/StructureDefinition/BundleKOrderCz"
          },
          {
            "key": "same-servicerequest-performer",
            "severity": "warning",
            "human": "All ServiceRequests SHALL have the same performer[0] (if present).",
            "expression": "entry.resource.ofType(ServiceRequest).count() <= 1 or entry.resource.ofType(ServiceRequest).all(performer.first() = entry.resource.ofType(ServiceRequest).first().performer.first())",
            "source": "https://hl7.cz/fhir/korder/StructureDefinition/BundleKOrderCz"
          },
          {
            "key": "same-servicerequest-occurrence",
            "severity": "warning",
            "human": "All ServiceRequests SHALL have the same occurrence[x] (if present).",
            "expression": "entry.resource.ofType(ServiceRequest).count() <= 1 or entry.resource.ofType(ServiceRequest).all(occurrence = entry.resource.ofType(ServiceRequest).first().occurrence)",
            "source": "https://hl7.cz/fhir/korder/StructureDefinition/BundleKOrderCz"
          }
        ]
      },
      {
        "id": "Bundle.identifier",
        "path": "Bundle.identifier",
        "short": "Business identifier of this document",
        "min": 1
      },
      {
        "id": "Bundle.type",
        "path": "Bundle.type",
        "short": "This SHALL be a document bundle",
        "patternCode": "document"
      },
      {
        "id": "Bundle.timestamp",
        "path": "Bundle.timestamp",
        "short": "Timestamp when the bundle was assembled",
        "min": 1
      },
      {
        "id": "Bundle.total",
        "path": "Bundle.total",
        "max": "0"
      },
      {
        "id": "Bundle.link",
        "path": "Bundle.link",
        "max": "0"
      },
      {
        "id": "Bundle.entry",
        "path": "Bundle.entry",
        "slicing": {
          "discriminator": [
            {
              "type": "type",
              "path": "resource"
            },
            {
              "type": "profile",
              "path": "resource"
            }
          ],
          "rules": "open"
        },
        "min": 3
      },
      {
        "id": "Bundle.entry:composition",
        "path": "Bundle.entry",
        "sliceName": "composition",
        "min": 1,
        "max": "1"
      },
      {
        "id": "Bundle.entry:composition.resource",
        "path": "Bundle.entry.resource",
        "min": 1,
        "type": [
          {
            "code": "Composition",
            "profile": [
              "https://hl7.cz/fhir/korder/StructureDefinition/KOrderCompositionCz"
            ]
          }
        ]
      },
      {
        "id": "Bundle.entry:patient",
        "path": "Bundle.entry",
        "sliceName": "patient",
        "min": 1,
        "max": "1"
      },
      {
        "id": "Bundle.entry:patient.resource",
        "path": "Bundle.entry.resource",
        "min": 1,
        "type": [
          {
            "code": "Patient",
            "profile": [
              "https://hl7.cz/fhir/core/StructureDefinition/cz-patient-core"
            ]
          }
        ]
      },
      {
        "id": "Bundle.entry:serviceRequest",
        "path": "Bundle.entry",
        "sliceName": "serviceRequest",
        "min": 1,
        "max": "*"
      },
      {
        "id": "Bundle.entry:serviceRequest.resource",
        "path": "Bundle.entry.resource",
        "type": [
          {
            "code": "ServiceRequest",
            "profile": [
              "https://hl7.cz/fhir/korder/StructureDefinition/KOrderServiceRequestCz"
            ]
          }
        ]
      },
      {
        "id": "Bundle.entry:condition",
        "path": "Bundle.entry",
        "sliceName": "condition",
        "min": 0,
        "max": "*"
      },
      {
        "id": "Bundle.entry:condition.resource",
        "path": "Bundle.entry.resource",
        "type": [
          {
            "code": "Condition",
            "profile": [
              "https://hl7.cz/fhir/korder/StructureDefinition/KOrderConditionCz"
            ]
          }
        ]
      },
      {
        "id": "Bundle.entry:practitioner",
        "path": "Bundle.entry",
        "sliceName": "practitioner",
        "min": 0,
        "max": "*"
      },
      {
        "id": "Bundle.entry:practitioner.resource",
        "path": "Bundle.entry.resource",
        "type": [
          {
            "code": "Practitioner",
            "profile": [
              "https://hl7.cz/fhir/core/StructureDefinition/cz-practitioner-core"
            ]
          }
        ]
      },
      {
        "id": "Bundle.entry:practitionerRole",
        "path": "Bundle.entry",
        "sliceName": "practitionerRole",
        "min": 0,
        "max": "*"
      },
      {
        "id": "Bundle.entry:practitionerRole.resource",
        "path": "Bundle.entry.resource",
        "type": [
          {
            "code": "PractitionerRole",
            "profile": [
              "https://hl7.cz/fhir/core/StructureDefinition/cz-practitionerrole-core"
            ]
          }
        ]
      },
      {
        "id": "Bundle.entry:organization",
        "path": "Bundle.entry",
        "sliceName": "organization",
        "min": 0,
        "max": "*"
      },
      {
        "id": "Bundle.entry:organization.resource",
        "path": "Bundle.entry.resource",
        "type": [
          {
            "code": "Organization",
            "profile": [
              "https://hl7.cz/fhir/core/StructureDefinition/cz-organization-core"
            ]
          }
        ]
      },
      {
        "id": "Bundle.entry:coverage",
        "path": "Bundle.entry",
        "sliceName": "coverage",
        "min": 0,
        "max": "*"
      },
      {
        "id": "Bundle.entry:coverage.resource",
        "path": "Bundle.entry.resource",
        "type": [
          {
            "code": "Coverage",
            "profile": [
              "https://hl7.cz/fhir/core/StructureDefinition/cz-coverage"
            ]
          }
        ]
      },
      {
        "id": "Bundle.entry:attachment",
        "path": "Bundle.entry",
        "sliceName": "attachment",
        "min": 0,
        "max": "*"
      },
      {
        "id": "Bundle.entry:attachment.resource",
        "path": "Bundle.entry.resource",
        "type": [
          {
            "code": "DocumentReference",
            "profile": [
              "https://hl7.cz/fhir/core/StructureDefinition/cz-attachment"
            ]
          }
        ]
      },
      {
        "id": "Bundle.signature",
        "path": "Bundle.signature",
        "short": "Digital signature of the document",
        "type": [
          {
            "code": "Signature",
            "profile": [
              "https://hl7.cz/fhir/core/StructureDefinition/cz-signature"
            ]
          }
        ]
      }
    ]
  }
}
